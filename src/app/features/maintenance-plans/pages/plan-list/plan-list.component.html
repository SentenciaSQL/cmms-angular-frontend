<div>
  <app-page-breadcrumb pageTitle="Planes de Mantenimiento" />
  <div class="min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12">
<!--    <div class="mx-auto w-full max-w-[630px] text-center">-->
      <h3 class="mb-4 font-semibold text-gray-800 text-theme-xl dark:text-white/90 sm:text-2xl">
        Card Title Here
      </h3>

      <button (click)="navigateToCreate()">
        Nuevo Plan
      </button>

      <p class="text-sm text-gray-500 dark:text-gray-400 sm:text-base">
        <button
          (click)="navigateToCreate()"
          class="inline-flex items-center justify-center gap-2.5 rounded-md bg-primary px-6 py-3 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-10">
        <span>
          <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 4.375V15.625" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4.375 10H15.625" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
          Nuevo Plan
        </button>
      </p>
<!--    </div>-->
  </div>
</div>

<div class="mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10">

  <!-- Breadcrumb -->
  <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <h2 class="text-title-md2 font-bold text-black dark:text-white">
      Planes de Mantenimiento
    </h2>

    <nav>
      <ol class="flex items-center gap-2">
        <li>
          <a class="font-medium" href="/">Dashboard /</a>
        </li>
        <li class="font-medium text-primary">Planes de Mantenimiento</li>
      </ol>
    </nav>
  </div>

  <!-- Action Bar -->
  <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <!-- Search (opcional) -->
    <div class="relative">
      <input
        type="text"
        placeholder="Buscar planes..."
        class="w-full rounded-lg border border-stroke bg-transparent py-3 pl-10 pr-4 outline-none focus:border-primary dark:border-form-strokedark dark:bg-form-input"
      />
      <span class="absolute left-3 top-4">
        <svg class="fill-body" width="20" height="20" viewBox="0 0 20 20" fill="none">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M9.16666 3.33332C5.945 3.33332 3.33332 5.945 3.33332 9.16666C3.33332 12.3883 5.945 15 9.16666 15C12.3883 15 15 12.3883 15 9.16666C15 5.945 12.3883 3.33332 9.16666 3.33332ZM1.66666 9.16666C1.66666 5.02452 5.02452 1.66666 9.16666 1.66666C13.3088 1.66666 16.6667 5.02452 16.6667 9.16666C16.6667 13.3088 13.3088 16.6667 9.16666 16.6667C5.02452 16.6667 1.66666 13.3088 1.66666 9.16666Z" fill=""/>
          <path fill-rule="evenodd" clip-rule="evenodd" d="M13.2857 13.2857C13.6112 12.9603 14.1388 12.9603 14.4642 13.2857L18.0892 16.9107C18.4147 17.2362 18.4147 17.7638 18.0892 18.0892C17.7638 18.4147 17.2362 18.4147 16.9107 18.0892L13.2857 14.4642C12.9603 14.1388 12.9603 13.6112 13.2857 13.2857Z" fill=""/>
        </svg>
      </span>
    </div>

    <!-- Buttons -->
    <div class="flex gap-3">
      <button
        (click)="navigateToCreate()"
        class="inline-flex items-center justify-center gap-2.5 rounded-md bg-primary px-6 py-3 text-center font-medium text-white hover:bg-opacity-90 lg:px-8 xl:px-10">
        <span>
          <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 4.375V15.625" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4.375 10H15.625" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        Nuevo Plan
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex h-screen items-center justify-center bg-white dark:bg-boxdark">
    <div class="h-16 w-16 animate-spin rounded-full border-4 border-solid border-primary border-t-transparent"></div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading"
       class="rounded-sm border border-stroke bg-white p-7.5 shadow-default dark:border-strokedark dark:bg-boxdark">
    <div class="flex items-center gap-3 rounded-md bg-danger bg-opacity-10 p-5">
      <div class="flex h-9 w-9 items-center justify-center rounded-full border border-danger bg-white dark:bg-boxdark">
        <svg width="13" height="13" viewBox="0 0 13 13" fill="none">
          <path d="M6.4917 7.65579L11.106 12.2645C11.2545 12.4128 11.4715 12.5 11.6738 12.5C11.8762 12.5 12.0931 12.4128 12.2416 12.2645C12.5621 11.9445 12.5623 11.4317 12.2423 11.1114C12.2422 11.1113 12.2422 11.1113 12.2422 11.1113C12.242 11.1111 12.2418 11.1109 12.2416 11.1107L7.64539 6.50351C7.52388 6.38181 7.52388 6.18825 7.64539 6.06655L12.2589 1.45348C12.5802 1.13217 12.5802 0.61489 12.2589 0.293584C11.9376 -0.027722 11.4204 -0.027722 11.0991 0.293584L6.4917 4.90663C6.37019 5.02833 6.17663 5.02833 6.05512 4.90663L1.4481 0.293584C1.12679 -0.027722 0.60951 -0.027722 0.288204 0.293584C-0.0330973 0.61489 -0.0330973 1.13217 0.288204 1.45348L4.90124 6.06655C5.02275 6.18825 5.02275 6.38181 4.90124 6.50351L0.288204 11.1107C-0.0330973 11.432 -0.0330973 11.9493 0.288204 12.2706C0.60951 12.5919 1.12679 12.5919 1.4481 12.2706L6.05512 7.65579C6.17663 7.53409 6.37019 7.53409 6.4917 7.65579Z" fill="#DC2626"></path>
        </svg>
      </div>
      <div class="w-full">
        <h5 class="mb-1 font-bold leading-[22px] text-[#D13131]">
          Error al cargar
        </h5>
        <p class="text-sm leading-relaxed text-[#D13131]">
          {{ error }}
        </p>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && plans.length === 0"
       class="rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark">
    <div class="flex flex-col items-center justify-center p-20">
      <div class="mx-auto mb-7.5 flex h-[90px] w-[90px] items-center justify-center rounded-full bg-meta-2 dark:bg-meta-4">
        <svg class="fill-primary dark:fill-white" width="40" height="40" viewBox="0 0 40 40" fill="none">
          <path d="M20 4.16666C11.7157 4.16666 4.99999 10.8824 4.99999 19.1667C4.99999 27.451 11.7157 34.1667 20 34.1667C28.2843 34.1667 35 27.451 35 19.1667C35 10.8824 28.2843 4.16666 20 4.16666ZM20 7.49999C26.4433 7.49999 31.6667 12.7234 31.6667 19.1667C31.6667 25.61 26.4433 30.8333 20 30.8333C13.5567 30.8333 8.33332 25.61 8.33332 19.1667C8.33332 12.7234 13.5567 7.49999 20 7.49999Z" fill=""/>
          <path d="M20 12.5V22.5L26.6667 26.6667" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h4 class="mb-3 text-xl font-semibold text-black dark:text-white">
        No hay planes de mantenimiento
      </h4>
      <p class="mb-7.5 max-w-sm text-center">
        Comienza creando tu primer plan de mantenimiento preventivo para gestionar el mantenimiento de tus activos.
      </p>
      <button
        (click)="navigateToCreate()"
        class="inline-flex items-center justify-center gap-2.5 rounded-md bg-primary px-6 py-3 text-center font-medium text-white hover:bg-opacity-90">
        <span>
          <svg class="fill-current" width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 4.375V15.625" stroke="white" stroke-width="2" stroke-linecap="round"/>
            <path d="M4.375 10H15.625" stroke="white" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
        Crear Primer Plan
      </button>
    </div>
  </div>

  <!-- Plans Table -->
  <div *ngIf="!loading && !error && plans.length > 0"
       class="rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark">

    <div class="px-4 py-6 md:px-6 xl:px-7.5">
      <h4 class="text-xl font-bold text-black dark:text-white">
        Todos los Planes ({{ plans.length }})
      </h4>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full table-auto">
        <thead>
        <tr class="bg-gray-2 text-left dark:bg-meta-4">
          <th class="min-w-[220px] px-4 py-4 font-medium text-black dark:text-white xl:pl-11">
            Plan
          </th>
          <th class="min-w-[150px] px-4 py-4 font-medium text-black dark:text-white">
            Activo
          </th>
          <th class="min-w-[120px] px-4 py-4 font-medium text-black dark:text-white">
            Tipo
          </th>
          <th class="min-w-[120px] px-4 py-4 font-medium text-black dark:text-white">
            Frecuencia
          </th>
          <th class="min-w-[120px] px-4 py-4 font-medium text-black dark:text-white">
            Prioridad
          </th>
          <th class="min-w-[150px] px-4 py-4 font-medium text-black dark:text-white">
            Próxima Ejecución
          </th>
          <th class="px-4 py-4 font-medium text-black dark:text-white">
            Estado
          </th>
          <th class="px-4 py-4 font-medium text-black dark:text-white">
            Acciones
          </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let plan of plans"
            class="border-b border-[#eee] dark:border-strokedark hover:bg-gray-2 dark:hover:bg-meta-4">

          <!-- Plan Name -->
          <td class="px-4 py-5 pl-9 xl:pl-11">
            <h5 class="font-medium text-black dark:text-white cursor-pointer hover:text-primary"
                (click)="navigateToDetail(plan.id)">
              {{ plan.name }}
            </h5>
            <p class="text-sm text-body">{{ plan.description || 'Sin descripción' }}</p>
          </td>

          <!-- Asset -->
          <td class="px-4 py-5">
<!--            <p class="text-black dark:text-white">{{ plan.asset?.name || 'N/A' }}</p>-->
<!--            <p class="text-sm text-body">{{ plan.asset?.code || '' }}</p>-->
          </td>

          <!-- Type -->
          <td class="px-4 py-5">
              <span class="inline-flex rounded-full bg-opacity-10 px-3 py-1 text-sm font-medium bg-success text-success">
                {{ getTypeLabel(plan.type) }}
              </span>
          </td>

          <!-- Frequency -->
          <td class="px-4 py-5">
            <p class="text-black dark:text-white text-sm">
              {{ getFrequencyLabel(plan.frequency, plan.frequencyValue) }}
            </p>
          </td>

          <!-- Priority -->
          <td class="px-4 py-5">
            <p [class]="getPriorityClass(plan.priority)"
               class="inline-flex rounded-full bg-opacity-10 px-3 py-1 text-sm font-medium">
              {{ plan.priority }}
            </p>
          </td>

          <!-- Next Scheduled Date -->
          <td class="px-4 py-5">
            <p class="text-black dark:text-white">
              {{ plan.nextScheduledDate | date: 'dd/MM/yyyy' }}
            </p>
            <p class="text-sm text-body">
              {{ plan.nextScheduledDate | date: 'HH:mm' }}
            </p>
          </td>

          <!-- Status -->
          <td class="px-4 py-5">
            <p *ngIf="plan.isActive"
               class="inline-flex rounded-full bg-success bg-opacity-10 px-3 py-1 text-sm font-medium text-success">
              Activo
            </p>
            <p *ngIf="!plan.isActive"
               class="inline-flex rounded-full bg-danger bg-opacity-10 px-3 py-1 text-sm font-medium text-danger">
              Inactivo
            </p>
          </td>

          <!-- Actions -->
          <td class="px-4 py-5">
            <div class="flex items-center space-x-3.5">
              <!-- View -->
              <button
                (click)="navigateToDetail(plan.id)"
                class="hover:text-primary"
                title="Ver detalle">
                <svg class="fill-current" width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M8.99981 14.8219C3.43106 14.8219 0.674805 9.50624 0.562305 9.28124C0.47793 9.11249 0.47793 8.88749 0.562305 8.71874C0.674805 8.49374 3.43106 3.20624 8.99981 3.20624C14.5686 3.20624 17.3248 8.49374 17.4373 8.71874C17.5217 8.88749 17.5217 9.11249 17.4373 9.28124C17.3248 9.50624 14.5686 14.8219 8.99981 14.8219ZM1.85605 8.99999C2.4748 10.0406 4.89356 13.5562 8.99981 13.5562C13.1061 13.5562 15.5248 10.0406 16.1436 8.99999C15.5248 7.95936 13.1061 4.44374 8.99981 4.44374C4.89356 4.44374 2.4748 7.95936 1.85605 8.99999Z" fill=""/>
                  <path d="M9 11.3906C7.67812 11.3906 6.60938 10.3219 6.60938 9C6.60938 7.67813 7.67812 6.60938 9 6.60938C10.3219 6.60938 11.3906 7.67813 11.3906 9C11.3906 10.3219 10.3219 11.3906 9 11.3906ZM9 7.875C8.38125 7.875 7.875 8.38125 7.875 9C7.875 9.61875 8.38125 10.125 9 10.125C9.61875 10.125 10.125 9.61875 10.125 9C10.125 8.38125 9.61875 7.875 9 7.875Z" fill=""/>
                </svg>
              </button>

              <!-- Edit -->
              <button
                (click)="navigateToEdit(plan.id)"
                class="hover:text-primary"
                title="Editar">
                <svg class="fill-current" width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M16.1999 9.30005H14.3999C13.7999 9.30005 13.2999 9.80005 13.2999 10.4V15.3C13.2999 15.9 13.7999 16.4 14.3999 16.4H16.1999C16.7999 16.4 17.2999 15.9 17.2999 15.3V10.4C17.2999 9.80005 16.7999 9.30005 16.1999 9.30005ZM15.9999 15.3H14.5999V10.5H15.9999V15.3Z" fill=""/>
                  <path d="M6.89998 9.30005H5.09998C4.49998 9.30005 3.99998 9.80005 3.99998 10.4V15.3C3.99998 15.9 4.49998 16.4 5.09998 16.4H6.89998C7.49998 16.4 7.99998 15.9 7.99998 15.3V10.4C7.99998 9.80005 7.49998 9.30005 6.89998 9.30005ZM6.69998 15.3H5.29998V10.5H6.69998V15.3Z" fill=""/>
                  <path d="M11.5499 5.30005H9.74994C9.14994 5.30005 8.64994 5.80005 8.64994 6.40005V15.4C8.64994 16 9.14994 16.5 9.74994 16.5H11.5499C12.1499 16.5 12.6499 16 12.6499 15.4V6.40005C12.6499 5.80005 12.1499 5.30005 11.5499 5.30005ZM11.3499 15.4H9.94994V6.50005H11.3499V15.4Z" fill=""/>
                </svg>
              </button>

              <!-- Execute -->
              <button
                (click)="executePlan(plan.id)"
                class="hover:text-success"
                title="Ejecutar plan">
                <svg class="fill-current" width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M13.7535 2.47502H11.5879V1.9969C11.5879 1.15315 10.9129 0.478149 10.0691 0.478149H7.90352C7.05977 0.478149 6.38477 1.15315 6.38477 1.9969V2.47502H4.21914C3.40352 2.47502 2.72852 3.15002 2.72852 3.96565V4.8094C2.72852 5.42815 3.09414 5.9344 3.62852 6.1594L4.07852 15.4688C4.13477 16.6219 5.09102 17.5219 6.24414 17.5219H11.7004C12.8535 17.5219 13.8098 16.6219 13.866 15.4688L14.3441 6.13127C14.8785 5.90627 15.2441 5.3719 15.2441 4.78127V3.93752C15.2441 3.15002 14.5691 2.47502 13.7535 2.47502ZM7.67852 1.9969C7.67852 1.85627 7.79102 1.74377 7.93164 1.74377H10.0973C10.2379 1.74377 10.3504 1.85627 10.3504 1.9969V2.47502H7.70664V1.9969H7.67852ZM4.02227 3.96565C4.02227 3.85315 4.10664 3.74065 4.24727 3.74065H13.7535C13.866 3.74065 13.9785 3.82502 13.9785 3.96565V4.8094C13.9785 4.9219 13.8941 5.0344 13.7535 5.0344H4.24727C4.13477 5.0344 4.02227 4.95002 4.02227 4.8094V3.96565ZM11.7285 16.2563H6.27227C5.79414 16.2563 5.40039 15.8906 5.37227 15.3844L4.95039 6.2719H13.0785L12.6566 15.3844C12.6004 15.8625 12.2066 16.2563 11.7285 16.2563Z" fill=""/>
                </svg>
              </button>

              <!-- Delete -->
              <button
                (click)="deletePlan(plan.id)"
                class="hover:text-danger"
                title="Eliminar">
                <svg class="fill-current" width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M13.7535 2.47502H11.5879V1.9969C11.5879 1.15315 10.9129 0.478149 10.0691 0.478149H7.90352C7.05977 0.478149 6.38477 1.15315 6.38477 1.9969V2.47502H4.21914C3.40352 2.47502 2.72852 3.15002 2.72852 3.96565V4.8094C2.72852 5.42815 3.09414 5.9344 3.62852 6.1594L4.07852 15.4688C4.13477 16.6219 5.09102 17.5219 6.24414 17.5219H11.7004C12.8535 17.5219 13.8098 16.6219 13.866 15.4688L14.3441 6.13127C14.8785 5.90627 15.2441 5.3719 15.2441 4.78127V3.93752C15.2441 3.15002 14.5691 2.47502 13.7535 2.47502Z" fill=""/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination (opcional) -->
    <div class="flex justify-between border-t border-stroke px-8 py-5 dark:border-strokedark">
      <div class="flex items-center">
        <span class="text-sm text-black dark:text-white">
          Mostrando {{ plans.length }} de {{ plans.length }} planes
        </span>
      </div>
      <!-- Agregar paginación aquí si es necesario -->
    </div>
  </div>

</div>


